<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitRise</title>
    <link rel="stylesheet" href="styles/style.css">
    <!-- Leaflet CSS for Map -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
</head>
<body>
    <div id="header-placeholder"></div>
    
    <!-- Hero Section -->
    <section class="hero">
        <h1>Track your fitness and reach your goals</h1>
        <p>Monitor your daily activity, progress, and rewards</p>
        <button onclick="getStarted()">Get Started</button>
    </section>
    
    <!-- Dashboard Cards -->
    <main class="dashboard">
        <div class="card today">
          <h2>Today</h2>
          <p>Steps: 7,550 / 8,000</p>
          <p>Water: 5 / 8 cups</p>
          <p>Sleep: 6.5 / 8 hrs</p>
          <p>Streak: 3 Days</p>
          <p id="points">Points: 1200</p>
          <p>Badges: 4</p>
          <p id="message"></p>
          <div class="graph">[Progress Graph]</div>
        </div>
    
        <div class="card rewards">
          <h2>Rewards</h2>
          <p>500 pts â€“ Bronze Badge</p>
          <p>1000 pts â€“ Silver Badge</p>
          <p>2000 pts â€“ Gold Badge</p>
          <p>5000 pts â€“ Premium Badge</p>
        </div>
    
        <div class="card progress">
          <h2>Progress</h2>
          <p>Weekly Steps â†‘</p>
          <p>Water Intake â†‘</p>
          <p>Sleep Trend â†“</p>
          <p>Goal Change: Step Goal +500</p>
        </div>
    </main>

    <!-- Quotes + Map Section -->
    <section id="quotes-map-section" style="display: flex; justify-content: center; align-items: flex-start; gap: 40px; flex-wrap: wrap; margin: 40px 0;">
        <!-- Quotes -->
        <div id="quotes-box" style="flex: 1; min-width: 280px; max-width: 400px; text-align: center;">
          <h2>ðŸ’ª Motivation for Today</h2>
          <p id="quote" style="font-size: 1.1rem; font-style: italic; color: #555;"></p>
        </div>

        <!-- Map -->
        <div id="osm-map" style="flex: 1; min-width: 300px; max-width: 800px; height: 420px; border-radius: 14px; box-shadow: 0 6px 20px rgba(0,0,0,0.08);"></div>
    </section>
    
    <!-- Footer -->
    <footer>
        <p>Â© 2025 FitRise</p>
    </footer>

    <!-- Leaflet JS for Map -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <script>
        // Quotes Array
        const quotes = [
            "Push yourself, because no one else is going to do it for you.",
            "Your body can stand almost anything. Itâ€™s your mind you have to convince.",
            "Success starts with self-discipline.",
            "No excuses. Just results.",
            "Train insane or remain the same."
        ];
        document.getElementById("quote").textContent = quotes[Math.floor(Math.random() * quotes.length)];

        // Map Initialization
        const oaklandUniversity = { lat: 42.6716, lng: -83.2174 }; // Oakland University coordinates
        const map = L.map("osm-map").setView([oaklandUniversity.lat, oaklandUniversity.lng], 14);

        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
          maxZoom: 19,
        }).addTo(map);

        const userMarkerStyle = {
          radius: 6,
          weight: 2,
          color: "#1d4ed8",
          fillColor: "#60a5fa",
          fillOpacity: 0.9,
        };

        function fetchGyms(center) {
          const radius = 5000;
          const q = `
            [out:json][timeout:25];
            (
              node["leisure"="fitness_centre"](around:${radius},${center.lat},${center.lng});
              way["leisure"="fitness_centre"](around:${radius},${center.lat},${center.lng});
              relation["leisure"="fitness_centre"](around:${radius},${center.lat},${center.lng});
            );
            out center tags;
          `;

          fetch("https://overpass-api.de/api/interpreter", {
            method: "POST",
            body: "data=" + encodeURIComponent(q),
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
          })
            .then((r) => r.json())
            .then((data) => {
              const bounds = L.latLngBounds();
              (data.elements || []).forEach((el) => {
                const lat = el.lat || (el.center && el.center.lat);
                const lon = el.lon || (el.center && el.center.lon);
                if (!lat || !lon) return;

                const name = el.tags?.name || "Gym";
                const addr = [
                  el.tags?.["addr:housenumber"],
                  el.tags?.["addr:street"],
                  el.tags?.["addr:city"],
                ].filter(Boolean).join(" ");

                L.marker([lat, lon])
                  .addTo(map)
                  .bindPopup(`<strong>${name}</strong><br>${addr || "Address not listed"}`);

                bounds.extend([lat, lon]);
              });

              if (bounds.isValid()) {
                map.fitBounds(bounds.pad(0.1));
                if (map.getZoom() > 15) map.setZoom(15);
              }
            });
        }

        function go(center) {
          map.setView([center.lat, center.lng], 13);
          L.circleMarker([center.lat, center.lng], userMarkerStyle)
            .addTo(map)
            .bindPopup("You are here")
            .openPopup();
          fetchGyms(center);
        }

        // Load gyms at Oakland University first
        fetchGyms(oaklandUniversity);

        // Then ask for user location
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (pos) => go({ lat: pos.coords.latitude, lng: pos.coords.longitude }),
            () => console.log("Using Oakland University as default location"),
            { enableHighAccuracy: true, timeout: 8000, maximumAge: 0 }
          );
        }
    </script>

    <script type="module" src="js/main.js"></script>
</body>
</html>
